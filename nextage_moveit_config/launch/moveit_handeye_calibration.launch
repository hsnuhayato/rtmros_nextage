<launch>
 <arg name="kinematics_conf" default="$(find nextage_moveit_config)/config/kinematics_kdl.yaml" />

 # The planning and execution components of MoveIt! configured to 
 # publish the current configuration of the robot (simulated or real)
 # and the current state of the world as seen by the planner.
 <include file="$(find nextage_moveit_config)/launch/move_group.launch">
  <arg name="publish_monitored_planning_scene" value="true" />
  <arg name="kinematics_conf_file" value="$(arg kinematics_conf)"/>
 </include>
 # The visualization component of MoveIt!
 <include file="$(find nextage_moveit_config)/launch/moveit_rviz.launch"> 
    <arg name="config" value="true"/>
    <arg name="kinematics_conf" value="$(arg kinematics_conf)"/>
 </include>

 <include file="$(find nextage_moveit_config)/launch/planning_context.launch">
   <arg name="load_robot_description" value="true"/>
 </include>

 <arg name="handeye_calibration" default="false" />
 
<group if="$(arg handeye_calibration)">
    <arg name="namespace_prefix" default="demo_handeyecalibration" />
    <arg name="start_simulator" default="true" />

    <!-- tracking simulation frequency and noise parameters -->
    <param name="frequency" value="10" />
    <param name="translation_noise_stdev" value="0.001" />
    <param name="rotation_noise_stdev" value="0.0001" />

    <arg name="eye_on_hand" default="true" />

    <!-- transformations for the eye-on-base case -->
    <arg unless="$(arg eye_on_hand)" name="calibration_transformation" default="1 0 0.5 0 0 0 1" />
    <arg unless="$(arg eye_on_hand)" name="arbitrary_transformation" default="0.12 0.21 0.137 0 0 0 1" />
    <!-- transformations for the eye-on-hand case -->
    <arg if="$(arg eye_on_hand)" name="calibration_transformation" default="0.05 -0.04 -0.03 1 0 0 0" />
    <arg if="$(arg eye_on_hand)" name="arbitrary_transformation" default="0.6 0 0.1 0 0 0 1" />

    <arg name="robot_base_frame" value="WAIST" />
    <arg name="tracking_marker_frame" value="tracking_marker" />
    <arg name="right_handeye" default="true" />
     
    <arg  if="$(arg right_handeye)" name="robot_effector_frame" value="RARM_JOINT5_Link" />
    <arg  if="$(arg right_handeye)" name="tracking_base_frame" value="VIRTUAL_CAMERA_HAND_R" />
    <arg  if="$(arg right_handeye)" name="move_group" value="right_arm" />

    <arg unless="$(arg right_handeye)" name="robot_effector_frame" value="LARM_JOINT5_Link" />
    <arg unless="$(arg right_handeye)" name="tracking_base_frame" value="VIRTUAL_CAMERA_HAND_L" />
    <arg unless="$(arg right_handeye)" name="move_group" value="left_arm" />
    
 
    <!-- start easy_handeye -->
    <include ns="/nxo" file="$(find easy_handeye)/launch/calibrate.launch" >
        <arg name="start_rviz" value="false" />
	<!-- <arg name="move_group" value="$(arg move_group)"/> -->
        <arg name="namespace_prefix" value="$(arg namespace_prefix)" />
        <arg name="eye_on_hand" value="$(arg eye_on_hand)" />
        <arg name="publish_dummy" value="false" />

        <arg name="tracking_base_frame" value="$(arg tracking_base_frame)" />
        <arg name="tracking_marker_frame" value="$(arg tracking_marker_frame)" />
        <arg name="robot_base_frame" value="$(arg robot_base_frame)" />
        <arg name="robot_effector_frame" value="$(arg robot_effector_frame)" />

        <arg name="freehand_robot_movement" value="true" />
        <arg name="robot_velocity_scaling" value="0.5" />
        <arg name="robot_acceleration_scaling" value="0.2" />
    </include>

    <!-- start the simulated tracking -->
    <node name="tracking_simulator" pkg="easy_handeye_demo" type="tracking_simulator.py" output="screen">
        <param name="start_simulator" value="$(arg start_simulator)" />

        <param name="eye_on_hand" value="$(arg eye_on_hand)" />

        <param name="calibration_transformation" value="$(arg calibration_transformation)" />
        <param name="arbitrary_transformation" value="$(arg arbitrary_transformation)" />

        <param name="tracking_base_frame" value="$(arg tracking_base_frame)" />
        <param name="tracking_marker_frame" value="$(arg tracking_marker_frame)" />
        <param name="robot_base_frame" value="$(arg robot_base_frame)" />
        <param name="robot_effector_frame" value="$(arg robot_effector_frame)" />

        <param name="frequency" value="10" />
        <param name="translation_noise_stdev" value="0.0001" />
        <param name="rotation_noise_stdev" value="0.00001" />
    </node>
 </group>
 
</launch>
